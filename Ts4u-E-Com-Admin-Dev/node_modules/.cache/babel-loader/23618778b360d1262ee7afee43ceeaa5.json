{"ast":null,"code":"import _toConsumableArray from\"/home/e2e/e2e-microservice/20231007-e2e-microservice/Ts4u-E-Com-Admin-Dev/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/e2e/e2e-microservice/20231007-e2e-microservice/Ts4u-E-Com-Admin-Dev/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import axios from'axios';import{useHistory}from'react-router-dom';import{Card,Button,Table,Space,Input,Switch,Popconfirm,Modal}from'antd';import{EyeOutlined,DeleteOutlined,QuestionCircleOutlined,RetweetOutlined}from'@ant-design/icons';var Search=Input.Search;function ProductReviews(){var history=useHistory();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setIsLoading=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isReviewUpdating=_useState4[0],setIsReviewUpdating=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isModalVisible=_useState6[0],setIsModalVisible=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),reviews=_useState8[0],setReviews=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),selectedRowKeys=_useState10[0],setSelectedRowKeys=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),selectedRows=_useState12[0],setSelectedRows=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),selectedReview=_useState14[0],setSelectedReview=_useState14[1];var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),selectedComment=_useState16[0],setSelectedComment=_useState16[1];var _useState17=useState(''),_useState18=_slicedToArray(_useState17,2),selectedReply=_useState18[0],setSelectedReply=_useState18[1];var handleCancel=function handleCancel(){setIsModalVisible(false);setSelectedReview(null);setSelectedComment(\"\");setSelectedReply(\"\");};var showModal=function showModal(review){var _review$reply;setSelectedReview(review._id);setSelectedComment(review.comment);setSelectedReply(review.reply?(_review$reply=review.reply)===null||_review$reply===void 0?void 0:_review$reply.comment:\"\");setIsModalVisible(true);};var handleUpdate=function handleUpdate(){if(!selectedReview){return alert(\"Please select a review\");}setIsReviewUpdating(true);var data={comment:selectedComment,reply:{name:\"Seller\",profile:\"\",comment:selectedReply}};axios.put(\"/review/update/\".concat(selectedReview),data).then(function(res){var array=_toConsumableArray(reviews);var index=array.findIndex(function(r){return r._id===res.data.review._id;});array[index]=res.data.review;setReviews(array);setIsReviewUpdating(false);handleCancel();}).catch(function(err){setIsReviewUpdating(false);console.log(err);});};var deleteReview=function deleteReview(id){axios.delete(\"/review/delete/\".concat(id)).then(function(res){if(res.data.success){setReviews(function(prev){return prev.filter(function(review){return review._id!==id;});});}}).catch(function(err){console.log(err);});};useEffect(function(){setIsLoading(true);axios.get(\"/review/all\").then(function(res){setReviews(res.data.reviews);setIsLoading(false);}).catch(function(err){setIsLoading(false);});},[]);var handleTogglePublish=function handleTogglePublish(val,id){setIsLoading(true);axios.put(\"/review/togglepublish/\".concat(id),{isPublished:val}).then(function(res){var array=_toConsumableArray(reviews);var index=array.findIndex(function(r){return r._id===res.data.review._id;});array[index]=res.data.review;setReviews(array);setIsLoading(false);}).catch(function(err){setIsLoading(false);console.log(err);});//togglepublish\n};var rowSelection={selectedRowKeys:selectedRowKeys,onChange:function onChange(selectedRowKeys,selectedRows){setSelectedRowKeys(selectedRowKeys);setSelectedRows(selectedRows);}};var columns=[{title:'Product',dataIndex:'product',key:'product',render:function render(product){return/*#__PURE__*/React.createElement(\"span\",null,product.name);}},{title:'Customer',dataIndex:'user',key:'user',render:function render(user){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"span\",null,user.name),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"span\",null,\"(\",user.email,\")\"));}},{title:'Rating',dataIndex:'rating',key:'raging',sorter:function sorter(a,b){return a.rating-b.rating;},render:function render(rating){return/*#__PURE__*/React.createElement(\"span\",null,rating);}},{title:'Comment',dataIndex:'comment',key:'raging',render:function render(comment){return/*#__PURE__*/React.createElement(\"span\",null,comment);}},{title:'Reply',dataIndex:'reply',key:'reply',render:function render(reply){return/*#__PURE__*/React.createElement(\"span\",null,reply?reply===null||reply===void 0?void 0:reply.comment:\"N/A\");}},{title:'Published',key:'isPublished',dataIndex:'isPublished',//sorter: (a, b) => Number(a.isActive) - Number(b.isActive),\nrender:function render(isPublished,record){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Switch,{checked:isPublished,onChange:function onChange(val){return handleTogglePublish(val,record._id);}}));},filters:[{text:'Published',value:true},{text:'Unpublished',value:false}],onFilter:function onFilter(value,record){return record.isPublished===value;}},{title:'Action',key:'action',render:function render(text,record){return/*#__PURE__*/React.createElement(Space,{size:\"middle\"},/*#__PURE__*/React.createElement(Popconfirm,{onConfirm:function onConfirm(){return deleteReview(record._id);},title:\"Are you sure\\uFF1F\",icon:/*#__PURE__*/React.createElement(QuestionCircleOutlined,{style:{color:'red'}})},/*#__PURE__*/React.createElement(Button,{className:\"d-center\",icon:/*#__PURE__*/React.createElement(DeleteOutlined,null),danger:true})),/*#__PURE__*/React.createElement(Button,{onClick:function onClick(){return showModal(record);},className:\"d-center\",type:\"primary\",icon:/*#__PURE__*/React.createElement(RetweetOutlined,null)},\"Reply\"));}}];return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Modal,{title:\"Review\",zIndex:1111,visible:isModalVisible,onCancel:handleCancel,footer:[/*#__PURE__*/React.createElement(Button,{key:\"back\",onClick:function onClick(){return handleCancel();}},\"Cancel\"),/*#__PURE__*/React.createElement(Button,{key:\"submit\",type:\"primary\",loading:isReviewUpdating,onClick:function onClick(){return handleUpdate();}},\"Update\")]},/*#__PURE__*/React.createElement(\"p\",null,\"Comment\"),/*#__PURE__*/React.createElement(Input.TextArea,{placeholder:\"Write your comment here\",value:selectedComment,onChange:function onChange(e){return setSelectedComment(e.target.value);}}),/*#__PURE__*/React.createElement(\"p\",{style:{marginTop:\"10px\"}},\"Reply\"),/*#__PURE__*/React.createElement(Input.TextArea,{placeholder:\"Write your reply here\",value:selectedReply,onChange:function onChange(e){return setSelectedReply(e.target.value);}})),/*#__PURE__*/React.createElement(Card,{title:\"Product Reviews\"},/*#__PURE__*/React.createElement(Table,{rowKey:\"_id\"//rowSelection={rowSelection}\n,loading:isLoading,columns:columns,dataSource:reviews,pagination:{defaultPageSize:10,showSizeChanger:true,pageSizeOptions:['10','20','30'],showQuickJumper:true}})));}export default ProductReviews;","map":{"version":3,"sources":["/home/e2e/e2e-microservice/20231007-e2e-microservice/Ts4u-E-Com-Admin-Dev/src/pages/reviews/ProductReviews.js"],"names":["React","useEffect","useState","axios","useHistory","Card","Button","Table","Space","Input","Switch","Popconfirm","Modal","EyeOutlined","DeleteOutlined","QuestionCircleOutlined","RetweetOutlined","Search","ProductReviews","history","isLoading","setIsLoading","isReviewUpdating","setIsReviewUpdating","isModalVisible","setIsModalVisible","reviews","setReviews","selectedRowKeys","setSelectedRowKeys","selectedRows","setSelectedRows","selectedReview","setSelectedReview","selectedComment","setSelectedComment","selectedReply","setSelectedReply","handleCancel","showModal","review","_id","comment","reply","handleUpdate","alert","data","name","profile","put","then","res","array","index","findIndex","r","catch","err","console","log","deleteReview","id","delete","success","prev","filter","get","handleTogglePublish","val","isPublished","rowSelection","onChange","columns","title","dataIndex","key","render","product","user","email","sorter","a","b","rating","record","filters","text","value","onFilter","color","e","target","marginTop","defaultPageSize","showSizeChanger","pageSizeOptions","showQuickJumper"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react'\nimport axios from 'axios'\n\nimport { useHistory } from 'react-router-dom'\nimport { Card, Button, Table, Space, Input, Switch, Popconfirm, Modal } from 'antd';\nimport { EyeOutlined, DeleteOutlined, QuestionCircleOutlined, RetweetOutlined } from '@ant-design/icons'\nconst Search = Input.Search;\n\n\n\n\n\n\n\nfunction ProductReviews() {\n    const history = useHistory()\n    const [isLoading, setIsLoading] = useState(false)\n    const [isReviewUpdating, setIsReviewUpdating] = useState(false)\n    const [isModalVisible, setIsModalVisible] = useState(false)\n\n    const [reviews, setReviews] = useState([])\n    const [selectedRowKeys, setSelectedRowKeys] = useState([])\n    const [selectedRows, setSelectedRows] = useState([])\n\n    const [selectedReview, setSelectedReview] = useState(null)\n    const [selectedComment, setSelectedComment] = useState('')\n    const [selectedReply, setSelectedReply] = useState('')\n\n\n    const handleCancel = () => {\n        setIsModalVisible(false)\n        setSelectedReview(null)\n        setSelectedComment(\"\")\n        setSelectedReply(\"\")\n    }\n    const showModal = (review) => {\n        setSelectedReview(review._id)\n        setSelectedComment(review.comment)\n        setSelectedReply(review.reply ? review.reply?.comment : \"\")\n        setIsModalVisible(true)\n    }\n\n    const handleUpdate = () => {\n        if(!selectedReview){\n            return alert(\"Please select a review\")\n        }\n        setIsReviewUpdating(true)\n\n        let data={\n            comment:selectedComment,\n            reply:{\n                name:\"Seller\",\n                profile:\"\",\n                comment:selectedReply\n            }\n        }\n    \n        axios.put(`/review/update/${selectedReview}`, data)\n            .then(res => {\n                let array = [...reviews]\n                let index = array.findIndex(r => r._id === res.data.review._id)\n                array[index] = res.data.review\n                setReviews(array)\n                setIsReviewUpdating(false)\n                handleCancel()\n            })\n            .catch(err => {\n                setIsReviewUpdating(false)\n                console.log(err);\n            })\n    }\n\n    const deleteReview = (id) => {\n        axios.delete(`/review/delete/${id}`)\n        .then(res=>{\n            if(res.data.success){\n                setReviews(prev=>(\n                    prev.filter(review=>review._id !== id)\n                ))\n            }\n        })\n        .catch(err => {\n            console.log(err);\n        })\n    }\n\n\n    useEffect(() => {\n        setIsLoading(true)\n        axios.get(\"/review/all\")\n            .then(res => {\n                setReviews(res.data.reviews);\n                setIsLoading(false)\n            })\n            .catch(err => {\n                setIsLoading(false)\n            })\n    }, [])\n\n    \n\n    const handleTogglePublish = (val, id) => {\n        setIsLoading(true)\n        axios.put(`/review/togglepublish/${id}`, { isPublished: val })\n            .then(res => {\n                let array = [...reviews]\n                let index = array.findIndex(r => r._id === res.data.review._id)\n                array[index] = res.data.review\n                setReviews(array)\n                setIsLoading(false)\n            })\n            .catch(err => {\n                setIsLoading(false)\n                console.log(err);\n            })\n        //togglepublish\n    }\n\n\n    const rowSelection = {\n        selectedRowKeys,\n        onChange: (selectedRowKeys, selectedRows) => {\n\n            setSelectedRowKeys(selectedRowKeys);\n            setSelectedRows(selectedRows)\n        },\n    };\n\n\n    const columns = [\n        {\n            title: 'Product',\n            dataIndex: 'product',\n            key: 'product',\n            render: product =>\n                <span>{product.name}</span>\n        },\n        {\n            title: 'Customer',\n            dataIndex: 'user',\n            key: 'user',\n            render: user =>\n                <>\n                    <span>{user.name}</span><br />\n                    <span>({user.email})</span>\n                </>\n        },\n        {\n            title: 'Rating',\n            dataIndex: 'rating',\n            key: 'raging',\n            sorter: (a, b) => a.rating - b.rating,\n            render: rating =>\n                <span>{rating}</span>\n\n        },\n        {\n            title: 'Comment',\n            dataIndex: 'comment',\n            key: 'raging',\n            render: comment =>\n                <span>{comment}</span>\n\n        },\n        {\n            title: 'Reply',\n            dataIndex: 'reply',\n            key: 'reply',\n            render: reply =>\n                <span>{reply ? reply?.comment : \"N/A\"}</span>\n\n        },\n        {\n            title: 'Published',\n            key: 'isPublished',\n            dataIndex: 'isPublished',\n            //sorter: (a, b) => Number(a.isActive) - Number(b.isActive),\n            render: (isPublished, record) => (\n                <>\n                    <Switch checked={isPublished} onChange={val => handleTogglePublish(val, record._id)} />\n                </>\n            ),\n            filters: [\n                { text: 'Published', value: true },\n                { text: 'Unpublished', value: false },\n            ],\n            onFilter: (value, record) => record.isPublished === value\n        },\n        {\n            title: 'Action',\n            key: 'action',\n            render: (text, record) => (\n                <Space size=\"middle\">\n                    <Popconfirm onConfirm={() => deleteReview(record._id)} title=\"Are you sure？\" icon={<QuestionCircleOutlined style={{ color: 'red' }} />}>\n                        <Button className='d-center' icon={<DeleteOutlined />} danger></Button>\n                    </Popconfirm>\n                    <Button onClick={() => showModal(record)} className='d-center' type='primary' icon={<RetweetOutlined />}>Reply</Button>\n\n                </Space>\n            ),\n        },\n    ];\n\n    return (\n        <div>\n            <Modal\n                title=\"Review\"\n                zIndex={1111}\n                visible={isModalVisible}\n                onCancel={handleCancel}\n                footer={[\n                    <Button key=\"back\" onClick={() => handleCancel()}>\n                        Cancel\n                    </Button>,\n                    <Button key=\"submit\" type=\"primary\" loading={isReviewUpdating} onClick={() => handleUpdate()}>\n                        Update\n                    </Button>,\n                ]}\n            >\n                <p>Comment</p>\n                <Input.TextArea\n                    placeholder=\"Write your comment here\"\n                    value={selectedComment}\n                    onChange={e => setSelectedComment(e.target.value)}\n                />\n                <p style={{ marginTop: \"10px\" }}>Reply</p>\n                <Input.TextArea\n                    placeholder=\"Write your reply here\"\n                    value={selectedReply}\n                    onChange={e => setSelectedReply(e.target.value)}\n                />\n            </Modal>\n            <Card title=\"Product Reviews\">\n\n                <Table\n                    rowKey=\"_id\"\n                    //rowSelection={rowSelection}\n                    loading={isLoading}\n                    columns={columns}\n                    dataSource={reviews}\n                    pagination={{ defaultPageSize: 10, showSizeChanger: true, pageSizeOptions: ['10', '20', '30'], showQuickJumper: true }}\n                />\n            </Card>\n        </div>\n    )\n}\n\nexport default ProductReviews\n"]},"metadata":{},"sourceType":"module"}